(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{300:function(e,t,s){"use strict";s.r(t);var a=s(14),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("https://kubesphere.com.cn/docs/quick-start/all-in-one-on-linux/")]),e._v(" "),t("h2",{attrs:{id:"_1-安装kubekey"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装kubekey"}},[e._v("#")]),e._v(" 1. 安装KubeKey")]),e._v(" "),t("h4",{attrs:{id:"_1-先执行以下命令以确保您从正确的区域下载-kubekey。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-先执行以下命令以确保您从正确的区域下载-kubekey。"}},[e._v("#")]),e._v(" （1）先执行以下命令以确保您从正确的区域下载 KubeKey。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export KKZONE=cn\n")])])]),t("h4",{attrs:{id:"_2-执行以下命令下载-kubekey。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-执行以下命令下载-kubekey。"}},[e._v("#")]),e._v(" （2）执行以下命令下载 KubeKey。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /mnt/windows_share/kubekey\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-sfL")]),e._v(" https://get-kk.kubesphere.io "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("v1.0.1 "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" -\n")])])]),t("h4",{attrs:{id:"_3-然后-使kk成为全局可执行文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-然后-使kk成为全局可执行文件"}},[e._v("#")]),e._v(" （3）然后，使kk成为全局可执行文件")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cp ./kk /usr/local/bin \n")])])]),t("h2",{attrs:{id:"_2-使用kk安装kubesphere和kubernetes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用kk安装kubesphere和kubernetes"}},[e._v("#")]),e._v(" 2. 使用kk安装kubesphere和kubernetes")]),e._v(" "),t("h4",{attrs:{id:"_1-安装依赖tools"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装依赖tools"}},[e._v("#")]),e._v(" （1）安装依赖tools")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("依赖项")]),e._v(" "),t("th",[e._v("Kubernetes 版本 ≥ 1.18")]),e._v(" "),t("th",[e._v("Kubernetes 版本 < 1.18")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("code",[e._v("socat")])]),e._v(" "),t("td",[e._v("必须")]),e._v(" "),t("td",[e._v("可选但建议")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("conntrack")])]),e._v(" "),t("td",[e._v("必须")]),e._v(" "),t("td",[e._v("可选但建议")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("ebtables")])]),e._v(" "),t("td",[e._v("可选但建议")]),e._v(" "),t("td",[e._v("可选但建议")])]),e._v(" "),t("tr",[t("td",[t("code",[e._v("ipset")])]),e._v(" "),t("td",[e._v("可选但建议")]),e._v(" "),t("td",[e._v("可选但建议")])])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo apt-get update\nsudo apt-get -y install socat\nsudo apt-get -y install conntrack\n")])])]),t("h4",{attrs:{id:"_2-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[e._v("#")]),e._v(" （2）安装")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kk create cluster --with-kubernetes v1.18.6 --with-kubesphere v3.0.0\n")])])]),t("h2",{attrs:{id:"_3-一些错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-一些错误"}},[e._v("#")]),e._v(" 3. 一些错误")]),e._v(" "),t("h4",{attrs:{id:"_1-错误1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-错误1"}},[e._v("#")]),e._v(" (1)错误1")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("error execution phase preflight: [preflight] Some fatal errors occurred:\n\t[ERROR ExternalEtcdVersion]: couldn't load external etcd's certificate and key pair /etc/ssl/etcd/ssl/node-slave.pem, /etc/ssl/etcd/ssl/node-slave-key.pem: open /etc/ssl/etcd/ssl/node-slave.pem: no such file or directory\n\t[ERROR ExternalEtcdClientCertificates]: /etc/ssl/etcd/ssl/node-slave.pem doesn't exist\n\t[ERROR ExternalEtcdClientCertificates]: /etc/ssl/etcd/ssl/node-slave-key.pem doesn't exist\n[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`\nTo see the stack trace of this error execute with --v=5 or higher: Process exited with status 1  node=192.168.1.108\nWARN[13:26:20 CST] Task failed ...                              \nWARN[13:26:20 CST] error: interrupted by error\n")])])]),t("p",[e._v("在master节点执行")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(' sudo -E /bin/sh -c "/usr/local/bin/kubeadm init --config=/etc/kubernetes/kubeadm-config.yaml"\n ls -lh /etc/ssl/etcd/ssl/\n')])])]),t("p",[e._v("原来在/etc/ssl/etcd/ssl/中真不存在node-node3-key.pem、node-node3.pem，真么办？原来是我选择的是member模式。")]),e._v(" "),t("blockquote",[t("p",[e._v("解决方案")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cp /etc/ssl/etcd/ssl/member-slave-key.pem /etc/ssl/etcd/ssl/node-slave-key.pem\ncp /etc/ssl/etcd/ssl/member-slave.pem /etc/ssl/etcd/ssl/node-slave.pem\n")])])]),t("h4",{attrs:{id:"_2-错误2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-错误2"}},[e._v("#")]),e._v(" (2) 错误2")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('error: the server doesn\'t have a resource type "secret": Process exited with status 1 \nError: Failed to get cluster status: Failed to patch kubeadm secret: Failed to exec command: sudo -E /bin/sh -c "/usr/local/bin/kubectl patch -n kube-system secret kubeadm-certs -p \'{\\"data\\": {\\"external-etcd-ca.crt\\": \\"\\"}}\'" \nerror: the server doesn\'t have a resource type "secret": Process exited with status 1\n')])])]),t("p",[e._v("证书时间过期了，好像超过两个小时就有问题了，所以我直接删除直接重新搞了下就好了")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kk dalete cluster -f ./config-kubesphere.yaml\n")])])]),t("h4",{attrs:{id:"_3-错误3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-错误3"}},[e._v("#")]),e._v(" (3) 错误3")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[ERROR FileExisting-conntrack]: conntrack not found in system path\n")])])]),t("p",[e._v("缺少依赖(所有节点都安装下)")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("apt-get install conntrack\n")])])]),t("p",[e._v("查看kubesphere状态")]),e._v(" "),t("p",[e._v("kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath='{.items[0].metadata.name}') -f")]),e._v(" "),t("p",[e._v("kubectl get pod -A")]),e._v(" "),t("p",[e._v("重启")]),e._v(" "),t("p",[e._v("kubectl -n kubesphere-system rollout restart deploy/ks-installer")]),e._v(" "),t("p",[e._v("查看pod日志")]),e._v(" "),t("p",[e._v("kubectl logs ks-apiserver-5cf84f7895-vz8tx -n kubesphere-system")]),e._v(" "),t("p",[e._v("https://blog.csdn.net/networken/article/details/109010032")]),e._v(" "),t("p",[e._v("https://blog.csdn.net/iteye_14723/article/details/107560279?spm=1001.2014.3001.5501")])])}),[],!1,null,null,null);t.default=r.exports}}]);