(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{310:function(e,a,t){"use strict";t.r(a);var s=t(14),r=Object(s.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("索引就和书的目录一样，通过查看目录能够快速找到要查找内容，"),a("strong",[e._v("对于一个数据量较大的数据表来说，千万不要全表查询，一定要包含索引")]),e._v("；")]),e._v(" "),a("h3",{attrs:{id:"索引失效的场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引失效的场景"}},[e._v("#")]),e._v(" 索引失效的场景")]),e._v(" "),a("p",[e._v("其实加索引并不难，但是再表关联等的时候会出现索引失效的场景，可通过"),a("code",[e._v("EXPLAIN")]),e._v("查看执行过程，在增加了索引的情况下，"),a("code",[e._v("type")]),e._v("为"),a("code",[e._v("ALL")]),e._v("的时候则索引失效。")]),e._v(" "),a("p",[e._v("这里简单写下此次优化过程中索引失效的一些场景：")]),e._v(" "),a("p",[e._v("对于一构建记录表，包含version")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('DROP TABLE IF EXISTS `t_record_info` ;\n\nCREATE TABLE `t_record_info` (\n  `name` VARCHAR(64) NOT NULL,\n  `type` INT(2) NOT NULL,\n  `version` VARCHAR(64) NOT NULL,\n  `create_time` DATETIME NOT NULL,\n  KEY `idx_create_time` (`create_time`),\n  KEY `idx_version` (`version`)\n);\n\nINSERT INTO `t_record_info` VALUE ("a",0,"version1",\'2020-12-01\');\nINSERT INTO `t_record_info` VALUE ("b",1,"version2",\'2021-01-01\');\nINSERT INTO `t_record_info` VALUE ("b",0,"version1",\'2021-02-01\');\n')])])]),a("p",[e._v("对于一version表")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("DROP TABLE IF EXISTS `t_version`;\n\nCREATE TABLE `t_version` (\n  `version_name` VARCHAR(64) NOT NULL,\n  `depart` VARCHAR(64) NOT NULL,\n  KEY `idx_version_name` (`version_name`),\n  KEY `depart` (`depart`)\n);\n\nINSERT INTO `t_version` VALUE (\"version1\",'d1');\nINSERT INTO `t_version` VALUE (\"version2\",'d1');\nINSERT INTO `t_version` VALUE (\"version3\",'d2');\nINSERT INTO `t_version` VALUE (\"version4\",'d2');\n")])])]),a("h4",{attrs:{id:"_1-不等于-部分like-开头-开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-不等于-部分like-开头-开始"}},[e._v("#")]),e._v(" （1） 不等于，部分like（开头%开始）")]),e._v(" "),a("p",[e._v("尽量避免where的时候使用<> 或者 !=操作，因为mysql支持<, <=, > ,=, BETWEEN, IN等")]),e._v(" "),a("ul",[a("li",[e._v("失效的场景")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("EXPLAIN SELECT * FROM t_record_info WHERE VERSION LIKE '%d%'\n")])])]),a("ul",[a("li",[e._v("OK的场景")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("EXPLAIN SELECT * FROM t_record_info WHERE VERSION LIKE 'd%'\n")])])]),a("h4",{attrs:{id:"_2-in子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-in子查询"}},[e._v("#")]),e._v(" （2）IN子查询")]),e._v(" "),a("p",[e._v("当version进行in子查询的时候")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("EXPLAIN SELECT * FROM t_record_info \nWHERE VERSION IN (SELECT version_name FROM t_version WHERE depart = 'd1');\n")])])]),a("p",[e._v("会发现"),a("code",[e._v("t_record_info")]),e._v("的version索引会失效，type会成"),a("code",[e._v("ALL")])]),e._v(" "),a("h5",{attrs:{id:"解决策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决策略"}},[e._v("#")]),e._v(" 解决策略")]),e._v(" "),a("p",[e._v("（1）使用exit代码")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("代码省略\n")])])]),a("p",[e._v("（2）使用关联表")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("EXPLAIN SELECT * FROM t_record_info AS a \nLEFT JOIN t_version AS b\nON a.`version` = b.`version_name`\nWHERE b.`depart` = 'd1';\n")])])]),a("p",[e._v("（3）使用业务代码独立（采用）")]),e._v(" "),a("p",[e._v("查询两次，第二次的时候直接使用in的")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("SELECT version_name FROM t_version WHERE depart = 'd1'\n")])])]),a("p",[e._v("业务代码先计算出version列表（也可以使用临时表进行存储），然后再查询")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("SELECT * FROM t_record_info WHERE VERSION IN ('version1','version2')\n")])])]),a("h3",{attrs:{id:"一些建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些建议"}},[e._v("#")]),e._v(" 一些建议")]),e._v(" "),a("p",[e._v("（1）最左匹配原则")]),e._v(" "),a("p",[e._v("尽量把最常用的字段放在最前面")]),e._v(" "),a("p",[e._v("（2）尽量把离散值较高的字段往前放")]),e._v(" "),a("p",[e._v("（3） 查询时，有的列是非等值条件，有点是等值条件，则等值条件字段放在前面")])])}),[],!1,null,null,null);a.default=r.exports}}]);